---
title: "2. Transformation and Adjustments"
author: "Ankit Tyagi"
date: "12/24/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Adjustments :- Adjustments sometimes leads to a simpler forecasting task. The purpose of these adjustments is to simplify the patterns in the historical data by removing the known sources of variation or by making the pattern more consistent across the whole dataset. 

There are 4 kinds of adjustments :- calendar adjustments, population adjustments, inflation adjustments and mathematical transformation.

1. Calender Adjusment :- Some of the variation in the data may be due to simple calender effects. For eg. if we are studying the monthly milk production on a farm, there will be variation between the months simply because of different no. of days in each month.

Below we are plotting the original series and series after the calendar adjustment.
```{r}
library(fpp2)
dframe = cbind(Monthly = milk,
               DailyAverage = milk/monthdays(milk))

autoplot(dframe, facet = TRUE) +
  xlab("Years") + ylab("Pounds") +
  ggtitle("Milk Production per cow")
```

2. Population Adjustment :- Any data that are affected by population changes can be adjusted to give per-capita data. That is, consider the data per person (or per thousand people, or per million people) rather than the total.

3. Inflation Adjustment :- Data which are affected by the value of money are best adjusted before modelling.
To make these adjustments, a price index is used. If  $z_t$  denotes the price index and  $y_t$ denotes the original house price in year t, then $x_t = y_t /z_t ∗ z_{2000}$ gives the adjusted house price at year 2000 dollar values.

4. Mathematical Transformation:- Transformations are important if the data shows variation that increase and decrease with the level of the series. 
Some examples of transformation is logarithmic transformation, power transformation etc. Log transformation are easiest to interpret. Changes in a log value are relative (or percentage) changes on the original scale. So if log base 10 is used, then an increase of 1 on the log scale corresponds to a multiplication of 10 on the original scale.

Power transformation can be written as $$w_t = y_{t}^{p}$$.

Box-Cox Transformation:- This is a family of transformation that includes both log and power transformation.
This transformation depends on ℷ.

$$ w_t = log(y_t) if\ \ λ = 0$$
$$else\ w_t = (y_{t}^{λ} - 1) / λ $$
If λ = 1, then $w_t = y_t −1$ , so the transformed data is shifted downwards but there is no change in the shape of the time series. But for all other values of λ, the time series will change shape.

Let's see how change in value of λ will effect our time series equation.
```{r}
par(mfrow = c(3,2))
plot(log(elec), main = "Electricity Consumption US", ylab = "lambda = 0")
for (i in seq(0.1,0.5,0.1)){
  plot((elec^i - 1)/i, main = "Electricity Consumption US", ylab = paste("lambda = ", i))
}
```

```{r}
par(mfrow = c(3,2))
for (i in seq(0.6,1,0.1)){
  plot((elec^i - 1)/i, main = "Electricity Consumption US", ylab = paste("lambda = ", i))
}
```

A good value of λ that makes the size of seasonal variation about the same across the whole series
In the above graph values around 0.3 are working well. We can also identify the ideal value using boxcox.lambda function.
But we don't wants use the exact same value as provided by the function. We need to select a simpler value for λ but the function will help us with the nearby value that we need consider. 
```{r}
BoxCox.lambda(elec)
lambda = BoxCox.lambda(elec)
autoplot(BoxCox(elec, lambda))
```

Having chosen a transformation, we need to forecast the transformed data. Then, we need to reverse the transformation (or back-transform) to obtain forecasts on the original scale. The reverse Box-Cox transformation is given by
$$ y_t = exp(w_t) if\ \ λ = 0$$
$$else\ y_t = (λw_t + 1)^{1/λ} $$

Features of transformation :-
1. If the time series values are negative than no power transformation is possible. We can adjust the values by adding a constant value.
2. The forecasting results are relatively insenstive to the value of λ. Transformation usually have large effect on prediction interval.

